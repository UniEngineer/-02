<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>3D Viewer (Адаптивный)</title>
    <style>
        body { margin: 0; font-family: Arial; }
        #device-selector {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            color: white;
        }
        button {
            padding: 8px 12px;
            margin: 5px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 3px;
        }
        #viewer { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <div id="device-selector">
        <p>Выберите устройство:</p>
        <button id="btn-pc">ПК версия</button>
        <button id="btn-mobile">Мобильная версия</button>
    </div>
    <div id="viewer"></div>

    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        // 1. Определение устройства по умолчанию
        const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
        let currentMode = isMobile ? 'mobile' : 'pc';
        
        // 2. Элементы управления
        document.getElementById('btn-pc').addEventListener('click', () => {
            currentMode = 'pc';
            initViewer();
        });
        
        document.getElementById('btn-mobile').addEventListener('click', () => {
            currentMode = 'mobile';
            initViewer();
        });

        // 3. Инициализация вьюера
        function initViewer() {
            // Очищаем предыдущую сцену
            const viewer = document.getElementById('viewer');
            viewer.innerHTML = '';
            document.getElementById('device-selector').style.display = 'none';
            
            if (currentMode === 'pc') {
                initPCViewer();
            } else {
                initMobileViewer();
            }
        }

        // 4. Версия для ПК (полнофункциональная)
        function initPCViewer() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('viewer').appendChild(renderer.domElement);

            // Освещение
            const light = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(light);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            // Загрузка модели
            const loader = new THREE.GLTFLoader();
            loader.load(
                'model.glb',
                (gltf) => {
                    scene.add(gltf.scene);
                    camera.position.z = 5;
                    
                    // Анимация
                    function animate() {
                        requestAnimationFrame(animate);
                        renderer.render(scene, camera);
                    }
                    animate();
                }
            );
        }

        // 5. Ультра-легкая мобильная версия
        function initMobileViewer() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 100);
            const renderer = new THREE.WebGLRenderer({
                antialias: false,
                powerPreference: "low-power"
            });
            renderer.setPixelRatio(1); // Фиксированное значение для мобильных
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('viewer').appendChild(renderer.domElement);

            // Минимальное освещение
            const light = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(light);

            // Упрощенная загрузка
            const loader = new THREE.GLTFLoader();
            loader.load(
                'model.glb',
                (gltf) => {
                    // Упрощаем материалы
                    gltf.scene.traverse(child => {
                        if (child.isMesh) {
                            child.material.roughness = 0.9;
                            if (child.material.map) {
                                child.material.map.anisotropy = 1;
                            }
                        }
                    });
                    
                    scene.add(gltf.scene);
                    camera.position.z = 5;

                    // Ограниченная анимация (30 FPS)
                    let lastTime = 0;
                    function animate(time) {
                        requestAnimationFrame(animate);
                        if (time - lastTime < 33) return; // 30 FPS
                        lastTime = time;
                        renderer.render(scene, camera);
                    }
                    animate(0);
                }
            );
        }

        // Показываем выбор устройства при загрузке
        if (!isMobile) {
            document.getElementById('device-selector').style.display = 'block';
        } else {
            initViewer(); // Автовыбор мобильной версии
        }
    </script>
</body>
</html>
